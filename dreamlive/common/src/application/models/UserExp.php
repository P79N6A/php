<?php
class UserExp
{
    private static $level_list = array(
        1 => 0,
        2 => 80,
        3 => 240,
        4 => 540,
        5 => 1100,
        6 => 2100,
        7 => 3600,
        8 => 6600,
        9 => 11600,
        10 => 18600,
        11 => 26600,
        12 => 37100,
        13 => 51100,
        14 => 68600,
        15 => 90600,
        16 => 117100,
        17 => 148100,
        18 => 183600,
        19 => 233600,
        20 => 298100,
        21 => 387100,
        22 => 526100,
        23 => 685100,
        24 => 894100,
        25 => 1143100,
        26 => 1462100,
        27 => 1851100,
        28 => 2320100,
        29 => 2889100,
        30 => 3558100,
        31 => 4327100,
        32 => 5216100,
        33 => 6225100,
        34 => 7354100,
        35 => 8633100,
        36 => 10062100,
        37 => 11641100,
        38 => 13370100,
        39 => 15299100,
        40 => 17328100,
        41 => 19520000,
        42 => 22140000,
        43 => 24970000,
        44 => 28040000,
        45 => 31350000,
        46 => 34900000,
        47 => 38720000,
        48 => 42800000,
        49 => 47150000,
        50 => 51790000,
        51 => 56730000,
        52 => 61970000,
        53 => 67520000,
        54 => 73390000,
        55 => 79590000,
        56 => 86130000,
        57 => 93020000,
        58 => 100270000,
        59 => 107880000,
        60 => 115860000,
        61 => 124230000,
        62 => 133000000,
        63 => 142160000,
        64 => 151740000,
        65 => 161740000,
        66 => 172160000,
        67 => 183030000,
        68 => 194340000,
        69 => 206100000,
        70 => 218330000,
        71 => 231040000,
        72 => 244230000,
        73 => 257910000,
        74 => 272090000,
        75 => 286780000,
        76 => 301990000,
        77 => 317730000,
        78 => 334010000,
        79 => 350830000,
        80 => 368200000,
        81 => 386140000,
        82 => 404660000,
        83 => 423750000,
        84 => 443440000,
        85 => 463730000,
        86 => 484620000,
        87 => 506140000,
        88 => 528280000,
        89 => 551050000,
        90 => 574470000,
        91 => 598550000,
        92 => 623290000,
        93 => 648700000,
        94 => 674790000,
        95 => 701570000,
        96 => 729050000,
        97 => 757240000,
        98 => 786150000,
        99 => 815780000,
        100 => 846140000,
        101 => 877250000,
        102 => 909120000,
        103 => 941740000,
        104 => 975140000,
        105 => 1009320000,
        106 => 1044280000,
        107 => 1080050000,
        108 => 1116620000,
        109 => 1154000000,
        110 => 1192210000,
        111 => 1231260000,
        112 => 1271150000,
        113 => 1311890000,
        114 => 1353490000,
        115 => 1395960000,
        116 => 1439310000,
        117 => 1483550000,
        118 => 1528690000,
        119 => 1574730000,
        120 => 1621680000,
        121 => 1669560000,
        122 => 1718380000,
        123 => 1768130000,
        124 => 1818840000,
        125 => 1870510000,
        126 => 1923140000,
        127 => 1976760000,
        128 => 2031360000,
        129 => 2086950000,
        130 => 2143550000,
        131 => 2201170000,
        132 => 2259810000,
        133 => 2319480000,
        134 => 2380190000,
        135 => 2441950000,
        136 => 2504770000,
        137 => 2568660000,
        138 => 2633630000,
        139 => 2699680000,
        140 => 2766820000,
        141 => 2835070000,
        142 => 2904440000,
        143 => 2974920000,
        144 => 3046540000,
        145 => 3119300000,
        146 => 3193200000,
        147 => 3268270000,
        148 => 3344500000,
        149 => 3421900000,
        150 => 3500490000,
        151 => 3580280000,
        152 => 3661270000,
        153 => 3743470000,
        154 => 3826890000,
        155 => 3911540000,
        156 => 3997430000,
        157 => 4084570000,
        158 => 4172970000,
        159 => 4262630000,
        160 => 4353560000,
        161 => 4445780000,
        162 => 4539300000,
        163 => 4634110000,
        164 => 4730240000,
        165 => 4827690000,
        166 => 4926460000,
        167 => 5026580000,
        168 => 5128040000,
        169 => 5230850000,
        170 => 5335030000,
        171 => 5440590000,
        172 => 5547530000,
        173 => 5655860000,
        174 => 5765590000,
        175 => 5876730000,
        176 => 5989290000,
        177 => 6103280000,
        178 => 6218710000,
        179 => 6335580000,
        180 => 6453900000,
        181 => 6573690000,
        182 => 6694960000,
        183 => 6817700000,
        184 => 6941940000,
        185 => 7067680000,
        186 => 7194920000,
        187 => 7323690000,
        188 => 7453980000,
        189 => 7585800000,
        190 => 7719170000,
        191 => 7854100000,
        192 => 7990590000,
        193 => 8128650000,
        194 => 8268290000,
        195 => 8409520000,
        196 => 8552350000,
        197 => 8696790000,
        198 => 8842850000,
        199 => 8990530000,
        200 => 9139840000,
        201 => 9290800000,
        202 => 9443420000,
        203 => 9597690000,
        204 => 9753640000,
        205 => 9911270000,
        206 => 10070580000,
        207 => 10231600000,
        208 => 10394320000,
        209 => 10558750000,
        210 => 10724910000,
        211 => 10892810000,
        212 => 11062450000,
        213 => 11233840000,
        214 => 11406990000,
        215 => 11581910000,
        216 => 11758610000,
        217 => 11937100000,
        218 => 12117390000,
        219 => 12299480000,
        220 => 12483380000,
        221 => 12669110000,
        222 => 12856680000,
        223 => 13046080000,
        224 => 13237340000,
        225 => 13430460000,
        226 => 13625440000,
        227 => 13822310000,
        228 => 14021060000,
        229 => 14221700000,
        230 => 14424250000,
        231 => 14628720000,
        232 => 14835110000,
        233 => 15043430000,
        234 => 15253690000,
        235 => 15465900000,
        236 => 15680070000,
        237 => 15896210000,
        238 => 16114330000,
        239 => 16334430000,
        240 => 16556520000,
        241 => 16780620000,
        242 => 17006740000,
        243 => 17234870000,
        244 => 17465040000,
        245 => 17697250000,
        246 => 17931500000,
        247 => 18167820000,
        248 => 18406200000,
        249 => 18646650000,
        250 => 18889190000,
        251 => 19133830000,
        252 => 19380570000,
        253 => 19629420000,
        254 => 19880390000,
        255 => 20133490000,
        256 => 20388730000,
        257 => 20646120000,
        258 => 20905670000,
        259 => 21167380000,
        260 => 21431260000,
        261 => 21697330000,
        262 => 21965600000,
        263 => 22236060000,
        264 => 22508740000,
        265 => 22783640000,
        266 => 23060760000,
        267 => 23340130000,
        268 => 23621740000,
        269 => 23905600000,
        270 => 24191730000,
        271 => 24480140000,
        272 => 24770830000,
        273 => 25063810000,
        274 => 25359090000,
        275 => 25656680000,
        276 => 25956590000,
        277 => 26258830000,
        278 => 26563410000,
        279 => 26870330000,
        280 => 27179600000,
        281 => 27491240000,
        282 => 27805260000,
        283 => 28121650000,
        284 => 28440440000,
        285 => 28761630000,
        286 => 29085220000,
        287 => 29411240000,
        288 => 29739680000,
        289 => 30070550000,
        290 => 30403870000,
        291 => 30739650000,
        292 => 31077890000,
        293 => 31418600000,
        294 => 31761790000,
        295 => 32107470000,
        296 => 32455650000,
        297 => 32806340000,
        298 => 33159550000,
        299 => 33515280000,
        300 => 33873540000,
        301 => 34234350000,
        302 => 34597720000,
        303 => 34963640000,
        304 => 35332140000,
        305 => 35703220000,
        306 => 36076880000,
        307 => 36453150000,
        308 => 36832020000,
        309 => 37213500000,
        310 => 37597610000,
        311 => 37984360000,
        312 => 38373750000,
        313 => 38765790000,
        314 => 39160490000,
        315 => 39557860000,
        316 => 39957910000,
        317 => 40360650000,
        318 => 40766090000,
        319 => 41174230000,
        320 => 41585080000,
        321 => 41998660000,
        322 => 42414980000,
        323 => 42834030000,
        324 => 43255840000,
        325 => 43680410000,
        326 => 44107740000,
        327 => 44537860000,
        328 => 44970760000,
        329 => 45406450000,
        330 => 45844950000,
        331 => 46286270000,
        332 => 46730410000,
        333 => 47177380000,
        334 => 47627190000,
        335 => 48079850000,
        336 => 48535370000,
        337 => 48993760000,
        338 => 49455030000,
        339 => 49919180000,
        340 => 50386220000,
        341 => 50856170000,
        342 => 51329040000,
        343 => 51804820000,
        344 => 52283540000,
        345 => 52765200000,
        346 => 53249800000,
        347 => 53737370000,
        348 => 54227900000,
        349 => 54721400000,
        350 => 55217890000,
        351 => 55717380000,
        352 => 56219870000,
        353 => 56725370000,
        354 => 57233890000,
        355 => 57745440000,
        356 => 58260030000,
        357 => 58777670000,
        358 => 59298370000,
        359 => 59822130000,
        360 => 60348960000,
        361 => 60878880000,
        362 => 61411900000,
        363 => 61948010000,
        364 => 62487240000,
        365 => 63029590000,
        366 => 63575060000,
        367 => 64123680000,
        368 => 64675440000,
        369 => 65230350000,
        370 => 65788430000,
        371 => 66349690000,
        372 => 66914130000,
        373 => 67481760000,
        374 => 68052590000,
        375 => 68626630000,
        376 => 69203890000,
        377 => 69784380000,
        378 => 70368110000,
        379 => 70955080000,
        380 => 71545300000,
        381 => 72138790000,
        382 => 72735560000,
        383 => 73335600000,
        384 => 73938940000,
        385 => 74545580000,
        386 => 75155520000,
        387 => 75768790000,
        388 => 76385380000,
        389 => 77005300000,
        390 => 77628570000,
        391 => 78255200000,
        392 => 78885190000,
        393 => 79518550000,
        394 => 80155290000,
        395 => 80795420000,
        396 => 81438950000,
        397 => 82085890000,
        398 => 82736250000,
        399 => 83390030000,
        400 => 84047240000,
        401 => 84707900000,
        402 => 85372020000,
        403 => 86039590000,
        404 => 86710640000,
        405 => 87385170000,
        406 => 88063180000,
        407 => 88744700000,
        408 => 89429720000,
        409 => 90118250000,
        410 => 90810310000,
        411 => 91505910000,
        412 => 92205050000,
        413 => 92907740000,
        414 => 93613990000,
        415 => 94323810000,
        416 => 95037210000,
        417 => 95754200000,
        418 => 96474790000,
        419 => 97198980000,
        420 => 97926780000,
        421 => 98658210000,
        422 => 99393280000,
        423 => 100132000000,
        424 => 100874000000,
        425 => 101620000000,
        426 => 102370000000,
        427 => 103123000000,
        428 => 103880000000,
        429 => 104641000000,
        430 => 105406000000,
        431 => 106174000000,
        432 => 106946000000,
        433 => 107721000000,
        434 => 108501000000,
        435 => 109284000000,
        436 => 110071000000,
        437 => 110861000000,
        438 => 111656000000,
        439 => 112454000000,
        440 => 113256000000,
        441 => 114062000000,
        442 => 114871000000,
        443 => 115685000000,
        444 => 116502000000,
        445 => 117323000000,
        446 => 118148000000,
        447 => 118977000000,
        448 => 119810000000,
        449 => 120646000000,
        450 => 121487000000,
        451 => 122331000000,
        452 => 123179000000,
        453 => 124031000000,
        454 => 124887000000,
        455 => 125747000000,
        456 => 126611000000,
        457 => 127479000000,
        458 => 128351000000,
        459 => 129227000000,
        460 => 130107000000,
        461 => 130990000000,
        462 => 131878000000,
        463 => 132770000000,
        464 => 133666000000,
        465 => 134566000000,
        466 => 135469000000,
        467 => 136377000000,
        468 => 137289000000,
        469 => 138205000000,
        470 => 139125000000,
        471 => 140049000000,
        472 => 140977000000,
        473 => 141910000000,
        474 => 142846000000,
        475 => 143787000000,
        476 => 144731000000,
        477 => 145680000000,
        478 => 146633000000,
        479 => 147590000000,
        480 => 148551000000,
        481 => 149516000000,
        482 => 150486000000,
        483 => 151460000000,
        484 => 152437000000,
        485 => 153420000000,
        486 => 154406000000,
        487 => 155396000000,
        488 => 156391000000,
        489 => 157390000000,
        490 => 158393000000,
        491 => 159401000000,
        492 => 160412000000,
        493 => 161429000000,
        494 => 162449000000,
        495 => 163473000000,
        496 => 164502000000,
        497 => 165535000000,
        498 => 166573000000,
        499 => 167615000000,
        500 => 168661000000,
        501 => 169711000000,
        502 => 170766000000,
        503 => 171826000000,
        504 => 172889000000,
        505 => 173957000000,
        506 => 175029000000,
        507 => 176106000000,
        508 => 177187000000,
        509 => 178273000000,
        510 => 179363000000,
        511 => 180457000000,
        512 => 181556000000,
        513 => 182660000000,
        514 => 183767000000,
        515 => 184880000000,
        516 => 185997000000,
        517 => 187118000000,
        518 => 188243000000,
        519 => 189374000000,
        520 => 190508000000,
        521 => 191648000000,
        522 => 192792000000,
        523 => 193940000000,
        524 => 195093000000,
        525 => 196250000000,
        526 => 197412000000,
        527 => 198579000000,
        528 => 199750000000,
        529 => 200926000000,
        530 => 202106000000,
        531 => 203291000000,
        532 => 204481000000,
        533 => 205675000000,
        534 => 206874000000,
        535 => 208078000000,
        536 => 209286000000,
        537 => 210499000000,
        538 => 211716000000,
        539 => 212939000000,
        540 => 214166000000,
        541 => 215397000000,
        542 => 216634000000,
        543 => 217875000000,
        544 => 219121000000,
        545 => 220371000000,
        546 => 221626000000,
        547 => 222886000000,
        548 => 224151000000,
        549 => 225421000000,
        550 => 226695000000,
        551 => 227974000000,
        552 => 229258000000,
        553 => 230547000000,
        554 => 231841000000,
        555 => 233139000000,
        556 => 234443000000,
        557 => 235751000000,
        558 => 237064000000,
        559 => 238382000000,
        560 => 239704000000,
        561 => 241032000000,
        562 => 242365000000,
        563 => 243702000000,
        564 => 245044000000,
        565 => 246391000000,
        566 => 247744000000,
        567 => 249101000000,
        568 => 250463000000,
        569 => 251830000000,
        570 => 253202000000,
        571 => 254579000000,
        572 => 255961000000,
        573 => 257348000000,
        574 => 258740000000,
        575 => 260137000000,
        576 => 261538000000,
        577 => 262945000000,
        578 => 264358000000,
        579 => 265775000000,
        580 => 267197000000,
        581 => 268624000000,
        582 => 270056000000,
        583 => 271494000000,
        584 => 272936000000,
        585 => 274383000000,
        586 => 275836000000,
        587 => 277294000000,
        588 => 278757000000,
        589 => 280225000000,
        590 => 281698000000,
        591 => 283176000000,
        592 => 284660000000,
        593 => 286148000000,
        594 => 287642000000,
        595 => 289141000000,
        596 => 290646000000,
        597 => 292155000000,
        598 => 293670000000,
        599 => 295190000000,
        600 => 296715000000,
        601 => 298245000000,
        602 => 299781000000,
        603 => 301321000000,
        604 => 302868000000,
        605 => 304419000000,
        606 => 305976000000,
        607 => 307538000000,
        608 => 309105000000,
        609 => 310678000000,
        610 => 312256000000,
        611 => 313839000000,
        612 => 315428000000,
        613 => 317022000000,
        614 => 318621000000,
        615 => 320226000000,
        616 => 321836000000,
        617 => 323451000000,
        618 => 325072000000,
        619 => 326698000000,
        620 => 328330000000,
        621 => 329967000000,
        622 => 331610000000,
        623 => 333258000000,
        624 => 334911000000,
        625 => 336570000000,
        626 => 338235000000,
        627 => 339905000000,
        628 => 341580000000,
        629 => 343261000000,
        630 => 344947000000,
        631 => 346639000000,
        632 => 348336000000,
        633 => 350039000000,
        634 => 351748000000,
        635 => 353462000000,
        636 => 355181000000,
        637 => 356906000000,
        638 => 358637000000,
        639 => 360373000000,
        640 => 362115000000,
        641 => 363863000000,
        642 => 365616000000,
        643 => 367375000000,
        644 => 369139000000,
        645 => 370909000000,
        646 => 372685000000,
        647 => 374466000000,
        648 => 376253000000,
        649 => 378046000000,
        650 => 379844000000,
        651 => 381648000000,
        652 => 383458000000,
        653 => 385273000000,
        654 => 387094000000,
        655 => 388921000000,
        656 => 390754000000,
        657 => 392592000000,
        658 => 394436000000,
        659 => 396286000000,
        660 => 398142000000,
        661 => 400004000000,
        662 => 401871000000,
        663 => 403744000000,
        664 => 405623000000,
        665 => 407507000000,
        666 => 409398000000,
        667 => 411294000000,
        668 => 413197000000,
        669 => 415105000000,
        670 => 417019000000,
        671 => 418938000000,
        672 => 420864000000,
        673 => 422796000000,
        674 => 424733000000,
        675 => 426676000000,
        676 => 428626000000,
        677 => 430581000000,
        678 => 432542000000,
        679 => 434509000000,
        680 => 436482000000,
        681 => 438461000000,
        682 => 440446000000,
        683 => 442437000000,
        684 => 444434000000,
        685 => 446437000000,
        686 => 448446000000,
        687 => 450461000000,
        688 => 452482000000,
        689 => 454510000000,
        690 => 456543000000,
        691 => 458582000000,
        692 => 460627000000,
        693 => 462678000000,
        694 => 464736000000,
        695 => 466799000000,
        696 => 468869000000,
        697 => 470945000000,
        698 => 473026000000,
        699 => 475114000000,
        700 => 477208000000
    );
    
    public static function getUserExp($userid)
    {
        $dao_user_exp = new DAOUserExp($userid);
        $user_exp_info = $dao_user_exp->getUserExp();
        
        return (int) $user_exp_info['exp'];
    }

    public static function addUserExp($userid, $exp)
    {
        $dao_user_exp = new DAOUserExp($userid);
        $effected_rows = $dao_user_exp->incUserExp($exp);
        
        if (! $effected_rows) {
            $user_exp_info = array(
                "uid" => $userid,
                "exp" => $exp
            );
            $dao_user_exp->addUserExp($user_exp_info);
        }
        
        return true;
    }

    public static function getUserLevel($userid)
    {
        $exp = self::getUserExp($userid);
        return self::getLevelByExp($exp);
    }

    public static function getLevelByExp($exp)
    {
        if ($exp <= 0) {
            return 1;
        }
        
        $level_list = self::$level_list;
        $level_list = array_reverse($level_list, true);
        
        foreach ($level_list as $k => $v) {
            if ($exp >= $v) {
                return $k;
            }
        }
        
        return 1;
    }

    public static function getExpByLevel($level)
    {
        $level_list = self::$level_list;
        
        return $level_list[$level] ? $level_list[$level] : 0;
    }
}
?>