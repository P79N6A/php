<?php
class Policy
{
    private $_options  = array();
    private $_type     = "";
    
    private static $keywords  = array(
    0 => 'åŒåŸå¯çº¦',
    1 => 'çœŸäººçœ‹é€¼',
    2 => 'çœ‹ç¾å¥³è„±',
    3 => 'å¼€è½¦è½¯ä»¶',
    4 => 'ä¸‡çŒ©é’»å«ä¿¡',
    5 => 'å…¨è£¸',
    6 => 'æ€§æ„Ÿå…¨æ‹–',
    7 => 'è£¸ä½“ç›´æ’­',
    8 => 'çœ‹~ç¾~å¥³~é€¼',
    9 => 'çœ‹é€¼',
    10 => 'çœ‹ç¾å¥³è·³',
    11 => 'ä¸‡æ˜Ÿé’»',
    12 => 'é»„è‰²ç›´æ’­é—´çš„',
    13 => 'ä¸».å•µ.é¨’.è„±.æ‘¸.ä¹ƒ',
    14 => 'è‘³é‘«',
    15 => 'å¼€è½¦è¡¨æ¼”',
    16 => 'è„±å’£ç²¿èº«',
    17 => '+è–‡',
    18 => 'ç§åšç²¿å»–åŠ å¨',
    19 => 'é©¬ä¸Šå¼€è½¦',
    20 => 'åšçˆ±',
    21 => 'çœ‹ä’šå¦‹ä¾³æ„›',
    22 => 'ä¸‰åƒæ˜Ÿé’»ç§æˆ‘',
    23 => 'çœ‹æ€§æ„Ÿå…¨æ‹–',
    24 => 'ä¹°10ä¸‡ç –çŸ³',
    25 => 'è¨»æ½˜',
    26 => 'è£¸ç§€',
    27 => 'æ´å«',
    28 => 'è‡ªæ…°è§†é¢‘',
    29 => 'çœ‹é€¼çœ‹å¥¶',
    30 => 'å¤œæ˜ ç›´æ’­',
    31 => 'å‘¨ç»“çš„ç›´æ’­å¹³å°',
    32 => 'ç¤¼ç‰©ææˆ',
    33 => 'ä½ºå…‰è™‚å’ª',
    34 => 'æƒ³çœ‹BBçš„å“¥å“¥',
    35 => 'æˆ‘æ˜¯ç»çºªå…¬å¸çš„è¿è¥',
    36 => 'æ˜ å®¢å·',
    37 => 'åŠ å¦¹å¦¹å¾®ä¿¡',
    38 => 'ç§æ’­',
    39 => 'ä¸å‘å·¥èµ„',
    40 => 'ææˆé«˜',
    41 => 'æ¢ä¸ªå¹³å°',
    42 => 'æ²¡æœ‰ä»»åŠ¡',
    43 => 'æœ‰æ„æ„¿æ¢ä¸ªå¤§çš„å¹³å°',
    44 => 'æˆ‘æ˜¯èŠ±æ¤’',
    45 => 'æ”¶ç›Šé«˜',
    46 => 'æ— æ—¶é•¿',
    47 => 'æ¼ç©´',
    48 => 'æ¢å¹³å°',
    49 => 'æœ‰å…´è¶£æ¥',
    50 => 'å¹³å°æµé‡å¤§',
    51 => 'ä¿åº•',
    52 => 'ä¸»ç®¥',
    53 => 'éªšè„±',
    54 => 'èº¶èˆ',
    55 => 'çœ‹é€¼çœ‹å¥¶',
    56 => 'æœ‰å…´è¶£çš„åŠ ',
    57 => 'æ¢ä¸€ä¸ªå¹³å°',
    58 => 'å¥½çš„æ–¹é¢å‘å±•',
    59 => 'æ›´å¥½çš„å‘å±•',
    60 => 'æœ‰å…´è¶£åŠ æˆ‘',
    61 => 'å‘¨ç»“',
    62 => 'æœˆç»“',
    63 => 'æˆ‘æ˜¯ç›´æ’­è¿è¥',
    64 => 'è°ˆè°ˆåˆä½œ',
    65 => 'è§†é¢‘èŠ',
    66 => 'ä¸€å¯¾ä¸€',
    67 => 'çœ‹è¡¨æ¼”',
    68 => 'çœ‹æ¯”',
    69 => 'ç˜™é®µ',
    70 => 'ç¾.å¥³.å•Š',
    71 => 'è¦.ä¸.è¦',
    72 => 'æ¥.æˆ‘.å¹³',
    73 => 'è¯•.è¯•.å‘',
    74 => 'å¹¿æ‹›ä¸»æ’­',
    75 => 'æ„Ÿå…´è¶£çš„è¯',
    76 => 'æ—¥ç»“',
    77 => 'çœ‹å°‘å¥³è‡ªæ‘¸',
    78 => 'æœ‰æ²¡æœ‰å…´è¶£',
    79 => 'æ¥èŠ±æ¤’',
    80 => 'åŠ vä¿¡',
    81 => 'èŠ±æ¤’ç›´æ’­',
    82 => 'é«˜ææˆ',
    83 => 'é»„æ’­è½¯ä»¶',
    84 => 'çŸ³æ¦´ç›´æ’­',
    85 => 'ä¸»æ’­ç»æ´»',
    86 => 'ä¸‹è½½',
    87 => 'ç²‰æ¡ƒ',
    88 => 'å¤§å°ºåº¦',
    89 => 'å“¥å“¥åŠ æˆ‘',
    90 => 'ä¸€ä¸ªå¹³å°',
    91 => 'é»„æ’­',
    92 => 'è¯± æƒ‘',
    93 => 'è¯±æƒ‘',
    94 => 'æ„Ÿè°¢å¤§å®¶æ”¯æŒ',
    95 => 'æœ‰å…´è¶£ç§æˆ‘',
    96 => 'çœ‹å·¨ä¹³',
    97 => 'è¾£é¸¡å¹³å°',
    98 => 'è¿˜æˆ‘è¡€æ±—é’±',
    99 => 'å­¦ç”Ÿå¦¹',
    100 => 'åŒåŸ',
    101 => 'å°‘å¦‡',
    102 => 'å–·æ°´',
    103 => 'çº¦å°‘å¦‡',
    104 => 'åˆ«çš„å¹³å°',
    105 => 'çœ‹ä¸°æ»¡',
    106 => 'æ­£è§„å…¬å¸',
    107 => 'æ­£è§„å¹³å°',
    108 => 'å…‹æ‰£ä¸»æ’­å·¥èµ„',
    109 => 'åŠ V',
    110 => 'ä¸ªå¹³å°',
    111 => 'æ¿€æƒ…çƒ­èˆ',
    112 => 'ä¸å°é¡¶',
    113 => 'æ„Ÿè°¢å¤§å®¶å…³æ³¨',
    114 => 'å’£ç²¿',
    115 => 'è€ƒè™‘ä¸€ä¸‹',
    116 => 'è‡ªæ…°è§†é¢‘',
    117 => 'çš‡è‰²ç›´æ’­',
    118 => 'é˜´ç©´',
    119 => 'è¿‡å¯‚å¯',
    120 => 'æ”å„›',
    121 => 'å…¨è„±',
    122 => 'æ‰“ä¸ªå¹¿å‘Š',
    123 => 'é©¬ä¸Šå¼€æ’­',
    124 => 'é•å¥³Vä¿¡',
    125 => 'èºèº«',
    126 => 'æ’æ¯”',
    127 => 'å€®èŠ',
    128 => 'æŒ‡æŒ¥äº’åŠ¨',
    129 => 'å·¥èµ„æ—¥ç»“',
    130 => 'ä¸€æ€¼ä¸€',
    131 => 'æ‘èº«',
    132 => 'ç§äººå°ºåº¦',
    133 => 'è£¸æ’­è½¯ä»¶',
    134 => 'è„±å’£',
    135 => 'ç²¿èº«',
    136 => 'ä¼½å¾½',
    137 => '1v1',
    138 => 'è´äººæ¼',
    139 => 'è‰²èŠ',
    140 => 'ä¸»æ’­è–‡',
    141 => 'æ‹›Â ä¸»Â æ’­',
    142 => 'å¨Â ä¿¡',
    143 => 'ç©çƒ­èˆ',
    144 => 'å…¨éœ²å°è§†é¢‘',
    145 => 'æ­»å…¨å®¶',
    146 => 'å¤œæ˜ ç›´æ’­',
    147 => 'ä¸ä¼šå°å·',
    148 => 'çœ‹ç¾å¥³æ‹–å…‰',
    149 => 'ä¸šä½™æ—¶é—´',
    150 => 'æ‹›ä¸»æ’­',
    151 => 'æ‹è‘³ä¼ˆ',
    152 => 'ä¾³æ„›',
    153 => '1å¯¹1',
    154 => 'å¼€è½¦è¡¨æ¼”',
    //155 => '1âƒ£ï¸æ€¼1âƒ£ï¸',
    156 => 'å…¨ç²¿ç§åš',
    157 => 'åŠ å¨å·',
    158 => 'ç™¾åªšç›´æ’­',
    159 => 'è£¸ä½“ç›´æ’­',
    160 => 'èºå¥¶',
    161 => 'æ´—æ¾¡å…è´¹çœ‹',
    162 => 'çœ‹è¡¨æ¼”',
    163 => 'å€®èŠ',
    164 => 'éº»çƒ¦çœ‹ä¸‹ç§ä¿¡å“¦',
    165 => 'å’–å¨ä¿¡',
    );
    
    public function setOptions($options)
    {
        $this->_options = $options;
    }
    
    public function getOptions()
    {
        return $this->_options;
    }
    
    public static function getKeywords()
    {
        return self::$keywords;
    }
    
    public function setType($type)
    {
        $this->_type = $type;
    }
    
    public function getType()
    {
        return $this->_type;
    }
    
    public static function isDeny($content)
    {
        return preg_match("/[â‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨â‘©â€ââ‚âƒâ„â…â†â‡âˆâ‰âŠâ‹âŒâââââ‘â’â“ãŠ€ãŠãŠ‚ãŠƒãŠ„ãŠ…ãŠ†ãŠ‡ãŠˆãŠ‰â’¶â’·â’¸â’¹â’ºâ’»â’¼â’½â’¾â’¿â“€â“â“‚â“ƒâ“„â“…â“†â“‡â“ˆâ“‰â“Šâ“‹â“Œâ“â“â“â“â“‘â“’â““â“”â“•â“–â“—â“˜â“™â“šâ“›â“œâ“â“â“Ÿâ“ â“¡â“¢â“£â“¤â“¥â“¦â“§â“¨â“©â’œâ’â’â’Ÿâ’ â’¡â’¢â’£â’¤â’¥â’¦â’§â’¨â’©â’ªâ’«â’¬â’­â’®â’¯â’°â’±â’²â’³â’´â’µâ… â…¡â…¢â…£â…¤â…¥â…¦â…§â…¨â…©â…ªâ…«â…°â…±â…²â…³â…´â…µâ…¶â…·â…¸â…¹â…ºâ…»â…¼â‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨â‘©â‘ªâ‘«â‘¬â‘­â‘®â‘¯â‘°â‘±â‘²â‘³â“ªâ¶â·â¸â¹âºâ»â¼â½â¾â¿â“«â“¬â“­â“®â“¯â“°â“±â“²â“³â“´ãŠ€ãŠãŠ‚ãŠƒãŠ„ãŠ…ãŠ†ãŠ‡ãŠˆãŠ‰ãˆ ãˆ¡ãˆ¢ãˆ£ãˆ¤ãˆ¥ãˆ¦ãˆ§ãˆ¨ãˆ©â‘´â‘µâ‘¶â‘·â‘¸â‘¹â‘ºâ‘»â‘¼â‘½â‘¾â‘¿â’€â’â’‚â’ƒâ’„â’…â’†â’‡â’ˆâ’‰â’Šâ’‹â’Œâ’â’â’â’â’‘â’’â’“â’”â’•â’–â’—â’˜â’™â’šâ’›â… â…¡â…¢â…£â…¤â…¥â…¦â…§â…¨â…©â…ªâ…«â…°â…±â…²â…³â…´â…µâ…¶â…·â…¸â…¹â’¶â’·â’¸â’¹â’ºâ’»â’¼â’½â’¾â’¿â“€â“â“‚â“ƒâ“„â“…â“†â“‡â“ˆâ“‰â“Šâ“‹â“Œâ“â“â“â“â“‘â“’â““â“”â“•â“–â“—â“˜â“™â“šâ“›â“œâ“â“â“Ÿâ“ â“¡â“¢â“£â“¤â“¥â“¦â“§â“¨â“©â’œâ’â’â’Ÿâ’ â’¡â’¢â’£â’¤â’¥â’¦â’§â’¨â’©â’ªâ’«â’¬â’­â’®â’¯â’°â’±â’²â’³â’´â’µâ°â´âµâ¶â·â¸â¹â‚€â‚â‚‚â‚ƒâ‚„â‚…â‚†â‚‡â‚ˆâ‚‰â‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨â‘©â‘ªâ‘«â‘¬â‘­â‘®â‘¯â‘°â‘±â‘²â‘³ã‰‘ã‰’ã‰“ã‰”ã‰•ã‰–ã‰—ã‰˜ã‰™ã‰šã‰›ã‰œã‰ã‰ã‰ŸãŠ±ãŠ²ãŠ³ãŠ´ãŠµãŠ¶ãŠ·ãŠ¸ãŠ¹ãŠºãŠ»ãŠ¼ãŠ½ãŠ¾ãŠ¿â“ªâ“â“µâ“¶â“·â“¸â“¹â“ºâ“»â“¼â“½â“¾â‘´â‘µâ‘¶â‘·â‘¸â‘¹â‘ºâ‘»â‘¼â‘½â‘¾â‘¿â’€â’â’‚â’ƒâ’„â’…â’†â’‡âŠâ‹âŒâââââ‘â’â“â“«â“¬â“­â“®â“¯â“°â“±â“²â“³â“´ÂºÂ¹Â²Â³â´âµâ¶â·â¸â¹â‚€â‚â‚‚â‚ƒâ‚„â‚…â‚†â‚‡â‚ˆâ‚‰â’ˆâ’‰â’Šâ’‹â’Œâ’â’â’â’â’‘â’’â’“â’”â’•â’–â’—â’˜â’™â’šâ’›â… â…¡â…¢â…£â…¤â…¥â…¦â…§â…¨â…©â…°â…±â…²â…³â…´â…µâ…¶â…·â…¸â…¹ãŠ€ãŠãŠ‚ãŠƒãŠ„ãŠ…ãŠ†ãŠ‡ãŠˆãŠ‰ãˆ ãˆ¡ãˆ¢ãˆ£ãˆ¤ãˆ¥ãˆ¦ãˆ§ãˆ¨ãˆ©â“¶â“â“¹â“¶â“ºâ“µâ“·ã™ãšã›ãœãããŸã ]/u", $content) ? true : false;
    }
    
    public static function getNumbers($content)
    {
        $length = strlen($content);
        $numbers = "";
        for($i = 0; $i < $length; $i++) {
            if(is_numeric($content{$i})) {
                $numbers .= $content{$i};
            }
        }
        
        return $numbers;
    }
    
    public static function getCharacters($content)
    {
        $length = strlen($content);
        
        $characters = "";
        for($i = 0; $i < $length; $i++) {
            if(preg_match("/[a-z\d_]/iu", $content{$i})) {
                $characters .= $content{$i};
            }
        }
        
        return $characters;
    }
    
    static public function format($content)
    {
        //å»é™¤æ ‡ç‚¹ç¬¦å·
        $filter = 'Â´ ` ^ ~ < = > Â¬ | Â¦ _ Â¯ - , ; : ! Â¡ ? Â¿ / . Â¸ \' â€˜ â€™ " â€œ â€ Â« Â» ( ) [ ] { } @ $ * \ & # % + ËŠ ï¼Œ . , ; \' / [ ]  - = ` ~ ! @ # $ % ^ & * ( ) _ + { } \ | : " < > ï¼Œ ã€‚ ã€ ï¼ ï¼Ÿ ï½  ï¼š ï¼› >  ï¹‘ â€¢ ï¼‚ â€¦ ï½€ ï¼‡ â€˜ â€™ â€œ â€ ã€ ã€ âˆ• Â¦ â€– â€” ï¹› ï¹œ ã€ˆ ã€‰ ï¹ ï¹ ã€Œ ã€ â€¹ â€º ã€– ã€— ã€Š ã€‹ ã€” ã€• ã€ ã€ Â« Â» ã€ ã€‘ ï¹ ï¹• ï¹” ï¹– ï¹ ËŠ ï¹« ï¼  ï¸³ ï¼¿ Â¸ ï¸° ; Â¡ Â¿ ï¹Œ ï¹‹ Â´ Ë‹ â€• ï¸´ Â¯ ï¼ ï¿£ ï¹¢ ï¼‹ ï¹¦ ï¹¤ Â¬ Ëœ ï¹Ÿ ï¹© ï¹  ï¹ª ï¹¡ ï¹¨ ï¹ ï¹ Ë† â€ ï¹‰ ï¹Š Ë‡ ï¸µ ï¸· ï¸¿ ï¸¹ ï¸½ _ ï¹ ï¹ƒ ï¸» ï¸¶ ï¸¸ ï¹€ ï¸º ï¸¾ Ë‰ ï¹‚ ï¹„ ï¸¼ ï½ ğŸ˜ â˜';
        $content = str_replace(explode(' ', $filter), "", $content);
        $content = preg_replace("/\s+/", "", $content);
        
        //ç¬¦å·æ ‡å‡†åŒ–
        $search   = "é›¶ ä¸€ äºŒ ä¸‰ å›› äº” å…­ ä¸ƒ å…« ä¹ å£¹ è´° å è‚† ä¼ é™† æŸ’ æŒ ç– ä¹… é…’ â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ ï¼ ï¼‘ ï¼’ ï¼“ ï¼” ï¼• ï¼– ï¼— ï¼˜ ï¼™ â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ O l â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰ â“Š â“‹ â“Œ â“ â“ â“ â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢ â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© â‚€ â‚ â‚‚ â‚ƒ â‚„ â‚… â‚† â‚‡ â‚ˆ â‚‰ â‘³ â‘¬ â“¹ â‘¡ â‘¥ â¶ â· â¸ â¹ âº â½ â’ª â‘´ â‘µ â‘¶ â‘¹ â‘º ğŸ…° 1Ì¶ 3Ì¶ 5Ì¶ 8Ì¶ 2Ì¶ â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾ â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’— â’™ â’š â’› â¶ â· â¸ â¹ âº â» â¼ â½ â¾ â¿ ãˆ  ãˆ¡ ãˆ¢ ãˆ£ ãˆ¤ ãˆ¥ ãˆ¦ ãˆ§ ãˆ¨ ãˆ© Âº Â¹ Â² Â³ â‚ â‚‚ â‚ƒÌ¶";
        $replace  = "0 1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9 9 9 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 1 2 3 4 5 6 7 8 9 0 1 A B C D E F G H I J K L M N O P Q R S T U V W X Y Z a b c d e f g h i j k l m n o p q r s t u v w x y z 0 1 2 3 4 5 6 7 8 9 20 13 5 2 6 1 2 3 4 5 8 0 1 2 3 6 7 A 1 3 5 8 2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 1 2 3 4 5 6 7 8 9 10 1 2 3 4 5 6 7 8 9 10 0 1 2 3 1 2 3";
        
        $search   = explode(' ', $search);
        $replace  = explode(' ', $replace);
        
        $content  = str_replace($search, $replace, $content);
        
        return $content;
    }
    
    public function getCache()
    {
        static $cache;
        
        if(!$cache) {
            $cache = Cache::getInstance("REDIS_CONF_CACHE");
        }
        
        return $cache;
    }
    
    public function getWords($content)
    {
        $sc = scws_open();
        scws_set_charset($sc, "utf8");
        scws_set_ignore($sc, true);
        scws_set_dict($sc, "", SCWS_XDICT_TXT);
        scws_set_rule($sc, ini_get('scws.default.fpath').'/rules_cht.utf8.ini');
        scws_send_text($sc, $content);
        
        $words = array();
        while($blocks = scws_get_result($sc)) {
            foreach ($blocks as $block) {
                if ($block['len'] == 1 && $block['word'] == "\r") {
                    continue;
                }
                if ($block['len'] == 1 && $block['word'] == "\n") {
                    $words[] = $block['word'];
                } else {
                    $words[] = sprintf("%s", $block['word']);
                }
            }
        }
        
        scws_close($sc);
        
        return $words;
    }
    
    static public function replace_emoji($str)
    {
        $tmpStr = json_encode($str); //æš´éœ²å‡ºunicode
        $tmpStr = preg_replace('/\\\ud([8-9a-f][0-9a-z]{2})/i', "", $tmpStr); //å°†emojiçš„unicodeç•™ä¸‹ï¼Œå…¶ä»–ä¸åŠ¨
        $new_str = json_decode($tmpStr);
        return $new_str;
    }
}
?>